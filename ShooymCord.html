<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShooymCord</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>

<style>
/* --- SAME CSS AS BEFORE --- */
:root { --bg-tertiary:#1e1f22; --bg-secondary:#2b2d31; --bg-primary:#313338; --header-primary:#f2f3f5; --header-secondary:#949ba4; --text-normal:#dbdee1; --accent:#5865f2; --input-bg:#383a40; }
* { box-sizing: border-box; }
body { margin: 0; background: var(--bg-primary); color: var(--text-normal); font-family: 'gg sans', sans-serif; height: 100vh; overflow: hidden; display: flex; }
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #2b2d31; }
::-webkit-scrollbar-thumb { background: #1a1b1e; border-radius: 4px; }
.servers { width: 72px; background: var(--bg-tertiary); display: flex; flex-direction: column; align-items: center; padding-top: 12px; gap: 8px; }
.server-icon { width: 48px; height: 48px; background-color: var(--bg-primary); border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: 0.2s; color: var(--text-normal); position: relative; }
.server-icon:hover, .server-icon.active { border-radius: 16px; background-color: var(--accent); color: white; }
.channels { width: 240px; background: var(--bg-secondary); display: flex; flex-direction: column; }
.server-header { height: 48px; padding: 0 16px; display: flex; align-items: center; font-weight: bold; box-shadow: 0 1px 0 rgba(4,4,5,0.2); color: var(--header-primary); }
.channel-list { padding: 8px; flex: 1; overflow-y: auto; }
.channel-item { padding: 6px 8px; margin-bottom: 2px; border-radius: 4px; color: var(--header-secondary); cursor: pointer; display: flex; align-items: center; gap: 6px; }
.channel-item:hover { background: rgba(79, 84, 92, 0.16); color: var(--header-primary); }
.channel-item.active { background: rgba(88, 101, 242, 0.3); color: white; }
.user-bar { background: #232428; height: 52px; padding: 0 8px; display: flex; align-items: center; gap: 8px; }
.user-avatar-small { width: 32px; height: 32px; border-radius: 50%; }
.user-info { flex: 1; font-size: 0.85rem; font-weight: bold; overflow: hidden; }
.chat-area { flex: 1; display: flex; flex-direction: column; background: var(--bg-primary); position: relative; }
.chat-header { height: 48px; padding: 0 16px; display: flex; align-items: center; box-shadow: 0 1px 0 rgba(4,4,5,0.2); font-weight: bold; color: var(--header-primary); }
#chat-feed { flex: 1; overflow-y: auto; padding: 16px 0; display: flex; flex-direction: column; }
.message { padding: 4px 16px; margin-top: 4px; display: flex; gap: 16px; }
.message:hover { background: rgba(4, 4, 5, 0.07); }
.avatar { width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0; background: #555; }
.message-header { display: flex; align-items: baseline; gap: 8px; }
.username { font-weight: 500; color: #fff; cursor: pointer; }
.timestamp { font-size: 0.7rem; color: var(--header-secondary); }
.message-text { color: var(--text-normal); font-size: 1rem; line-height: 1.375rem; white-space: pre-wrap; word-wrap: break-word; }
.input-area { padding: 0 16px 24px; background: var(--bg-primary); }
.input-wrapper { background: var(--input-bg); border-radius: 8px; display: flex; align-items: center; padding: 10px 16px; }
#msg-input { background: transparent; border: none; color: var(--text-normal); outline: none; width: 100%; font-family: inherit; font-size: 1rem; }
/* Connection Status Indicator */
#conn-status { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; color: #fa777c; pointer-events: none; }
</style>
</head>
<body>

<nav class="servers">
    <div class="server-icon active"><i class="fa-brands fa-discord"></i></div>
</nav>

<div class="channels">
    <div class="server-header" id="server-name">Shooym Server</div>
    <div class="channel-list">
        <div class="channel-item active"><span style="color:#888">#</span> general</div>
        <div class="channel-item"><span style="color:#888">#</span> memes</div>
    </div>
    <div class="user-bar">
        <img src="" id="current-user-avatar" class="user-avatar-small" onclick="changeName()">
        <div class="user-info">
            <div id="display-username">...</div>
            <div style="font-size: 0.7rem; color: #aaa;">Online</div>
        </div>
    </div>
</div>

<main class="chat-area">
    <div id="conn-status">Disconnected</div>
    <header class="chat-header">
        <span style="color:var(--header-secondary); margin-right: 4px;">#</span> general
    </header>
    <div id="chat-feed"></div>
    <div class="input-area">
        <div class="input-wrapper">
            <input type="text" id="msg-input" placeholder="Connecting..." disabled>
        </div>
    </div>
</main>

<script>
    // --- CONFIG ---
    // MUST MATCH THE HOST ID EXACTLY
    const TARGET_SERVER_ID = "shooym-server-main-v1"; 

    // --- SETUP ---
    let myName = localStorage.getItem("shooym_username");
    if(!myName) {
        myName = prompt("Enter Username:", "User" + Math.floor(Math.random()*100));
        if(!myName) myName = "Anon";
        localStorage.setItem("shooym_username", myName);
    }
    
    updateUI(myName);

    // --- NETWORK ---
    const peer = new Peer(); // Random ID for client is fine
    let conn = null;

    peer.on('open', (id) => {
        console.log("My Peer ID: " + id);
        connectToHost();
    });

    function connectToHost() {
        document.getElementById('conn-status').innerText = "Connecting...";
        
        conn = peer.connect(TARGET_SERVER_ID);

        conn.on('open', () => {
            document.getElementById('conn-status').innerText = "Connected";
            document.getElementById('conn-status').style.color = "#43b581";
            document.getElementById('msg-input').disabled = false;
            document.getElementById('msg-input').placeholder = "Message #general";
            document.getElementById('msg-input').focus();
        });

        conn.on('data', (data) => {
            addMessageToFeed(data.user, data.msg);
        });

        conn.on('close', () => {
            document.getElementById('conn-status').innerText = "Disconnected (Retrying...)";
            document.getElementById('conn-status').style.color = "#fa777c";
            document.getElementById('msg-input').disabled = true;
            setTimeout(connectToHost, 3000); // Retry every 3s
        });
        
        // Handle connection errors (like if host is not open yet)
        peer.on('error', (err) => {
             console.log(err);
             setTimeout(connectToHost, 3000); 
        });
    }

    // --- CHAT LOGIC ---
    const msgInput = document.getElementById('msg-input');
    
    msgInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });

    function sendMessage() {
        const text = msgInput.value.trim();
        if (!text) return;

        if (conn && conn.open) {
            conn.send({ user: myName, msg: text });
            msgInput.value = '';
        }
    }

    function addMessageToFeed(user, text) {
        const feed = document.getElementById('chat-feed');
        const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(user)}&background=random`;

        const msgHTML = `
            <div class="message">
                <img src="${avatarUrl}" class="avatar">
                <div class="message-content">
                    <div class="message-header">
                        <span class="username">${user}</span>
                        <span class="timestamp">Today at ${time}</span>
                    </div>
                    <div class="message-text">${text}</div>
                </div>
            </div>`;

        feed.innerHTML += msgHTML;
        feed.scrollTop = feed.scrollHeight;
    }

    function updateUI(name) {
        document.getElementById('display-username').innerText = name;
        document.getElementById('current-user-avatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=232428&color=fff`;
    }

    function changeName() {
        let newName = prompt("New Username:", myName);
        if(newName) {
            myName = newName;
            localStorage.setItem("shooym_username", myName);
            updateUI(myName);
        }
    }
</script>
</body>
</html>
